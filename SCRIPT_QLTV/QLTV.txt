CREATE DATABASE QLTV
GO
USE QLTV
GO

SET DATEFORMAT DMY

CREATE TABLE CHUCVUNV
(
	MACHUCVU NVARCHAR(50) NOT NULL,
	CHUCVU NVARCHAR(100),
	CONSTRAINT PK_CVNV PRIMARY KEY(MACHUCVU)
)
GO

CREATE TABLE NHANVIEN
(
	MANV INT IDENTITY(1,1),
	HOTEN NVARCHAR(200),
	NGAYSINH SMALLDATETIME,
	MACHUCVU NVARCHAR(50),
	NGAYVAOLAM SMALLDATETIME,
	EMAIL NVARCHAR(200),
	SDT NVARCHAR(20),
	DIACHI NVARCHAR(200),
	LUONG MONEY,
	TIENPHAT MONEY,
	CONSTRAINT PK_NV PRIMARY KEY(MANV),
	CONSTRAINT FK_NV_CVNV FOREIGN KEY(MACHUCVU) REFERENCES CHUCVUNV(MACHUCVU)
)
GO



CREATE TABLE QUYDINHNHANVIEN
(
	STT INT IDENTITY NOT NULL,
	MAQD NVARCHAR(50) NOT NULL,
	TUOITOITHIEU INT,
	TUOITOIDA INT,
	NGAYRA DATETIME,
	NGAYKETTHUC DATETIME,
	CONSTRAINT PK_QDNV PRIMARY KEY(MAQD)
)
GO


GO

CREATE TABLE LOAIDOCGIA
(
	MALOAIDG NVARCHAR(50) NOT NULL,
	TENLOAIDG NVARCHAR(200),
	CONSTRAINT PK_LDG PRIMARY KEY(MALOAIDG)
)
GO

CREATE TABLE DOCGIA
(
	STT INT IDENTITY,
	MADG NVARCHAR(50) NOT NULL,
	HOTEN NVARCHAR(200),
	NGAYSINH SMALLDATETIME,
	DIACHI NVARCHAR(200),
	EMAIL NVARCHAR(200),
	NGAYLAPTHE SMALLDATETIME,
	NGAYHETHAN SMALLDATETIME,
	SOSACHDANGMUON INT,
	LUOTMUON INT,
	TONGTIENNO MONEY,
	MALOAIDG NVARCHAR(50),
	CONSTRAINT PK_DG PRIMARY KEY(MADG),
	CONSTRAINT FK_DG_LDG FOREIGN KEY(MALOAIDG) REFERENCES LOAIDOCGIA(MALOAIDG)
)
GO

CREATE TABLE QUYDINHTHEDOCGIA
(
	STT INT IDENTITY NOT NULL,
	MAQD NVARCHAR(50) NOT NULL,
	TUOITOITHIEU INT,
	TUOITOIDA INT,
	THOIHANTHE INT, -- tinh theo thang
	NGAYRA DATETIME,
	NGAYKETTHUC DATETIME,
	CONSTRAINT PK_QDTDG PRIMARY KEY(MAQD)
)
GO

CREATE TABLE THELOAISACH
(
	MATHELOAI NVARCHAR(50) NOT NULL,
	TENTHELOAI NVARCHAR(200),
	CONSTRAINT PK_TLS PRIMARY KEY(MATHELOAI)
)
GO

CREATE TABLE SACH
(
	MASACH NVARCHAR(50) NOT NULL,
	TENSACH NVARCHAR(200),
	TACGIA NVARCHAR(200),
	MATHELOAI NVARCHAR(50),
	NXB NVARCHAR(200),
	NAMXB INT,
	NGAYNHAP SMALLDATETIME,
	DONGIA MONEY,
	SOLUONG INT,
	LUOTMUON INT,
	CONSTRAINT PK_S PRIMARY KEY(MASACH),
	CONSTRAINT FK_S_TLS FOREIGN KEY(MATHELOAI) REFERENCES THELOAISACH(MATHELOAI)
)
GO

CREATE TABLE QUYDINHSACH
(
	STT INT IDENTITY NOT NULL,
	MAQD NVARCHAR(50) NOT NULL,
	THOIHANSACH INT, -- khoang thoi gian tu nam xuat ban
	NGAYRA DATETIME,
	NGAYKETTHUC DATETIME,
	CONSTRAINT PK_QDS PRIMARY KEY(MAQD)
)
GO
DROP TABLE QUYDINHSACH


--CREATE TABLE CHITIETPHIEUMUON
--(
--	MACTPM NVARCHAR(50) NOT NULL,
--	MASACH NVARCHAR(50),
--	TENSACH NVARCHAR(200),
--	CONSTRAINT PK_CTPM PRIMARY KEY(MACTPM)
--)
--GO

CREATE TABLE PHIEUMUON
(
	MAPM INT IDENTITY(1,1) NOT NULL,
	MASACH NVARCHAR(50) NOT NULL,
	MADG NVARCHAR(50),
	NGAYMUON SMALLDATETIME,
	HANTRA SMALLDATETIME,
	SOLUONG INT,
	MUCPHAT MONEY, 
	CONSTRAINT PK_PM PRIMARY KEY(MAPM, MASACH)
)
GO

CREATE TABLE QUYDINHPHIEUMUON
(
	STT INT IDENTITY NOT NULL,
	MAQD NVARCHAR(50) NOT NULL,
	SOSACHTOIDA INT,
	SONGAYMUONTOIDA INT,
	NGAYRA DATETIME,
	NGAYKETTHUC DATETIME,
	CONSTRAINT PK_QDPM PRIMARY KEY(MAQD)
)
GO



CREATE TABLE PHIEUTRA
(
	MAPM NVARCHAR(50) NOT NULL,
	MASACH NVARCHAR(50) NOT NULL,
	MADG NVARCHAR(50),
	NGAYTRA SMALLDATETIME,
	TIENPHAT MONEY,
	CONSTRAINT PK_PT PRIMARY KEY(MAPM, MASACH)
)
GO

CREATE TABLE QUYDINHPHIEUTRA
(
	STT INT IDENTITY NOT NULL,
	MAQD NVARCHAR(50) NOT NULL,
	TIENPHAT INT, --tre n ngay, tra n*tienphat
	NGAYRA DATETIME,
	NGAYKETTHUC DATETIME,
	CONSTRAINT PK_QDPT PRIMARY KEY(MAQD)
)

CREATE TABLE TAIKHOANNV
(
	MATK INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	TENTK NVARCHAR(50),
	MATKHAU NVARCHAR (50),
	MACHUCVU NVARCHAR(50),
	MANV INT,
	CONSTRAINT FK_TK_NV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
	CONSTRAINT FK_TK_CV FOREIGN KEY(MACHUCVU) REFERENCES CHUCVUNV(MACHUCVU)
	
)